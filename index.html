<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ï¼©ï¼´ãƒ»ãƒ‡ã‚¸æˆ¦æ–°æ˜¥ãƒ‰ãƒ©ã‚³ãƒ³</title>

  <style>
    /* ============================
       ç´…ç™½ ç¸¦ã˜ã¾èƒŒæ™¯
       ============================ */
    body {
      margin: 0;
      padding: 20px;
      font-family: sans-serif;
      background: repeating-linear-gradient(
        90deg,
        #d7000f 0,
        #d7000f 60px,
        #ffffff 60px,
        #ffffff 120px
      );
    }

    /* èª­ã¿ã‚„ã™ã•å‘ä¸Šç”¨ */
    .container {
      max-width: 600px;
      margin: auto;
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 12px;
    }

    button {
      margin: 6px 4px;
      padding: 10px 16px;
      font-size: 16px;
    }
  </style>
</head>
<body>

<div class="container">

<h2>ï¼©ï¼´ãƒ»ãƒ‡ã‚¸æˆ¦æ–°æ˜¥ãƒ‰ãƒ©ã‚³ãƒ³ï¼ˆ3å›æ¸¬å®šï¼‰</h2>

<p style="font-size:0.9em; color:#555;">
ã“ã‚Œã¯ã€ChatGPTï¼ˆç„¡æ–™ç‰ˆï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã‚ˆã‚‹æŒ‡ç¤ºã®ã¿ã§ä½œæˆã—ãŸã‚‚ã®ã§ã™ã€‚<br>
Kizunaé‹å‹•åœ°åŸŸç¤¾ä¼šã¨ã®çµ†ãƒãƒ¼ãƒ 
</p>

<button onclick="requestPermission()">ã‚¹ã‚¤ãƒ³ã‚°é–‹å§‹</button>
<button onclick="stopSensor()">æ¸¬å®šçµ‚äº†</button>
<button onclick="resetAll()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>

<hr>

<div id="results">ã¾ã æ¸¬å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</div>

</div>

<script>
// ============================
// QRã‚³ãƒ¼ãƒ‰èªè¨¼
// ============================
const token = new URLSearchParams(location.search).get("token");
if (token !== "GOLF2026EVENT") {
  document.body.innerHTML = "ç„¡åŠ¹ãªQRã‚³ãƒ¼ãƒ‰ã§ã™";
}

// ============================
// æ¸¬å®šç®¡ç†å¤‰æ•°
// ============================
let maxAccel = 0;
let measurements = [];
let isMeasuring = false;

// ============================
// ã‚»ãƒ³ã‚µãƒ¼è¨±å¯
// ============================
function requestPermission() {
  if (measurements.length >= 3) {
    alert("æ¸¬å®šã¯3å›ã¾ã§ã§ã™ã€‚ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚");
    return;
  }

  if (typeof DeviceMotionEvent?.requestPermission === "function") {
    DeviceMotionEvent.requestPermission().then(res => {
      if (res === "granted") startSensor();
    });
  } else {
    startSensor();
  }
}

// ============================
// è¨ˆæ¸¬é–‹å§‹
// ============================
function startSensor() {
  maxAccel = 0;
  isMeasuring = true;
  window.addEventListener("devicemotion", handleMotion);
}

// ============================
// ã‚»ãƒ³ã‚µãƒ¼å‡¦ç†
// ============================
function handleMotion(e) {
  if (!isMeasuring) return;

  const a = e.accelerationIncludingGravity;
  if (!a) return;

  const mag = Math.sqrt(
    a.x * a.x +
    a.y * a.y +
    a.z * a.z
  );

  maxAccel = Math.max(maxAccel, mag);
}

// ============================
// è¨ˆæ¸¬çµ‚äº†ï¼ˆæ„Ÿåº¦èª¿æ•´ç‰ˆï¼‰
// ============================
function stopSensor() {
  if (!isMeasuring) return;

  isMeasuring = false;
  window.removeEventListener("devicemotion", handleMotion);

  const adjusted = Math.max(0, maxAccel - 9.8);
  let distance = 80 + Math.sqrt(adjusted) * 25;

  distance = Math.min(260, Math.max(80, distance));

  measurements.push(Math.round(distance));
  updateResults();
}

// ============================
// çµæœè¡¨ç¤º
// ============================
function updateResults() {
  let html = "";

  measurements.forEach((d, i) => {
    html += `<p>ç¬¬${i + 1}å›ï¼š${d} ãƒ¤ãƒ¼ãƒ‰</p>`;
  });

  if (measurements.length === 3) {
    const avg = Math.round(
      measurements.reduce((a, b) => a + b, 0) / 3
    );
    html += `<hr><h3>å¹³å‡é£›è·é›¢ï¼š${avg} ãƒ¤ãƒ¼ãƒ‰</h3>`;
  }

  document.getElementById("results").innerHTML = html;
}

// ============================
// ãƒªã‚»ãƒƒãƒˆå‡¦ç†
// ============================
function resetAll() {
  measurements = [];
  maxAccel = 0;
  isMeasuring = false;

  window.removeEventListener("devicemotion", handleMotion);
  document.getElementById("results").innerHTML =
    "ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚å†åº¦æ¸¬å®šã§ãã¾ã™ã€‚";
}
</script>

</body>
</html>
